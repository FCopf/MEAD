{
  "hash": "bdca3e555ab5600d0b375f4c07a4daa9",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Similaridade entre espécies: aplicação da álgebra matricial em Ecologia Funcional\"\ninstitute: \"9833 - BASES DA MATEMÁTICA E ESTATÍSTICA PARA CIÊNCIAS DO MAR\"\nauthor: \t\"Fabio Cop Ferreira e William Remo Pedroso Conti\"\ndescription: \"Cálculo da similaridade funcional entre espécies de peixes usando álgebra matricial.\"\ncategories: [\"Produto escalar\", \"Ângulo entre vetores\", \"Multiplicação matricial\", \"Matriz transposta\", \"Matriz simétrica\"]\nimage: \"images/cossine-similarity.png\"\n\nformat-resources:\n  - images/peixe\n\nformat: \n  html:\n    number-sections: true\n    number-depth: 3\n  typst:\n    toc: true\n    section-numbering: 1.1.\n    columns: 1\n\nexecute:\n  echo: false\n  warning: false\nlang: pt\n    \n---\n\n::: {.cell}\n\n:::\n\n\n\n\n\n\n## Matriz de Traços Morfológicos\n\n\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n\n\nConsidere a situação em que temos 8 espécies de peixes nas descritas por 6 *traços funcionais* (@tbl-tracos). Traços funcionais são características morfológicas, fisiológicas ou comportamentais mensuráveis que influenciam diretamente o desempenho ecológico das espécies, determinando como elas interagem com o ambiente e utilizam recursos (como habitats, alimento e abrigo). Espera-se, por exemplo, que espécies similares em seus traços funcionais ocupem um espaço de nicho e respondam de forma similar a pressões ambientais. Nosso objetivo será quantificar **o grau de similaridade** entre os pares de espécies por meio do índice de *similaridade por cossenos*.\n\n| Traço | Bstr      | Bsp       | Cfasc     | Czeb      | Cih       | Imin      | Hsp       | Hypsp      |\n|-------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|\n| CI    | 1.67 | 1.71 | 1.41 | 1.47 | 0.97 | 0.69 | 0.73 | 0.66 |\n| RD    | 0.21 | 0.26 | 0.21 | 0.22 | 0.17 | 0.12 | 0.16 | 0.19 |\n| IVF   | 0.57 | 0.53 | 0.51 | 0.49 | 0.59 | 0.55 | 0.39 | 0.35 |\n| RAC   | 0.14 | 0.13 | 0.14 | 0.11 | 0.22 | 0.26 | 0.19 | 0.3 |\n| REP   | 0.7 | 0.68 | 0.79 | 0.8 | 0.91 | 0.76 | 0.71 | 0.85 |\n| MO    | 1.26 | 1.74 | 3.03 | 1.98 | 2.06 | 2.24 | 3.14 | 3.14 |\n\n: Traços funcionais entre 8 espécies de peixes de riachos. **CI**: Índice de compressão; **RD**: Altura relativa; **IVF**: Índice de achatamento ventral; **RAC**: Área relativa da nadadeira caudal; **REP**: Posição relativa do olho; **MO**: orientação da boca. **Bstr**: *Bryconamericus stramineus*; **Bsp**: *Bryconamericus* sp.; **Cfasc**: *Characidium fasciatum*; **Czeb**: *Characidium zebra*; **Cih**: *Cetopsorhamdia iheringi*; **Imin**: *Imparfinis minutus*; **Hsp**: *Hisonotus* sp.; **Hypsp**: *Hypostomus sp*. {#tbl-tracos .striped}\n\n::: {#fig-peixes layout-ncol=2 layout-nrow=4 fig-cap=\"Espécies da @tbl-tracos.\"}\n\n![Bryconamericus stramineus](images/peixe/Bryconamericus-stramineus.png){width=80%}\n\n![Bryconamericus sp](images/peixe/Bryconamericus.png){width=80%}\n\n![Characidium fasciatum](images/peixe/Characidium-fasciatum.jpg){width=80%}\n\n![Characidium zebra](images/peixe/Characidium-zebra.jpg){width=80%}\n\n![Cetopsorhamdia iheringi](images/peixe/Cetopsorhamdia-iheringi.jpg){width=80%}\n\n![Imparfinis minutus](images/peixe/Imparfinis-minutus.jpg){width=80%}\n\n![Hisonotus sp](images/peixe/Hisonotus.jpg){width=80%}\n\n![Hypostomus sp](images/peixe/Hypostomus.png){width=80%}\n\n:::\n\nCada espécie está representada em uma coluna, e as linhas correspondem às medidas morfológicas que podem ser associadas aos traços funcionais das espécies. Em notação matricial, podemos representar a @tbl-tracos como:\n\n$$\\mathbf{T} = \n\\begin{bmatrix}\n1.67 & 1.71 & \\dots & 0.66\\\\\n0.21 & 0.26 & \\dots & 0.19\\\\\n\\vdots & \\vdots & \\ddots & \\vdots\\\\\n1.26 & 1.74 & \\dots & 3.14\n\\end{bmatrix}\n$$\n\n## Calculando Similaridade por cossenos\n\nCada espécie na @tbl-tracos pode ser vista como um *vetor* $\\vec{v}$ ou $\\vec{u}$ com 6 entradas, uma para cada traço funcional. Assim, o cosseno do ângulo $\\theta$ entre os vetores pode ser calculado por:\n\n$$\\cos(\\theta) = \\frac{\\vec{v} \\cdot \\vec{u}}{\\|\\vec{v}\\| \\|\\vec{u}\\|}\n$$ {#eq-cos-angulo}\n\nOnde:\n\n- $\\vec{v} \\cdot \\vec{u}$ é o **produto escalar** entre os vetores $\\vec{v}$ e $\\vec{u}$.\n- $\\|\\vec{v}\\|$ e $\\|\\vec{u}\\|$ são as **normas** (comprimentos) dos vetores.\n- $\\theta$ é o ângulo entre os vetores no espaço multidimensional de 6 dimensões.\n\nO valor do $\\cos(\\theta)$ funciona como um *índice de similaridade* cuja interpretação ecológica é direta:\n\n- **$\\cos(\\theta) \\approx 1$** (ângulo próximo a 0°), indica espécies com alta similaridade funcional, compartilhando estratégias ecológicas semelhantes;\n- **$\\cos(\\theta) \\approx 0$** (ângulo próximo a 90°) revela espécies ecologicamente distintas, com traços funcionais divergentes.\n\n---\n\n## Exemplo Prático: Similaridade entre *Bstr* e *Bsp*\n\n1. **Vetores das espécies**:\n\n$$\n\\vec{v}_{\\text{Bstr}} = \\begin{bmatrix}\n1.67 \\\\ 0.21 \\\\ 0.57 \\\\ 0.14 \\\\ 0.7 \\\\ 1.26\n\\end{bmatrix}, \\quad\n\\vec{u}_{\\text{Bsp}} = \\begin{bmatrix}\n1.71 \\\\ 0.26 \\\\ 0.53 \\\\ 0.13 \\\\ 0.68 \\\\ 1.74\n\\end{bmatrix}\n$$\n\n2. **Produto Escalar**:\n\n$$\\vec{v} \\cdot \\vec{u} = (1.67 \\times 1.71) + (0.21 \\times 0.26) + \\dots + (1.26 \\times 1.74) = 5.899$$\n\n3. **Normas dos Vetores**:\n$$\\|\\vec{v}\\| = \\sqrt{1.67^2 + 0.21^2 + \\dots + 1.26^2} \\approx 2.2924$$\n$$\\|\\vec{u}\\| = \\sqrt{1.71^2 + 0.26^2 + \\dots + 1.74^2} \\approx 2.6037$$\n\n4. **Cosseno do Ângulo**:\n$$\\cos(\\theta) = \\frac{5.899}{2.2924 \\times 2.6037} \\approx 0.988$$\n\n---\n\n## Similaridade por Cossenos a partir de operações matriciais\n\n\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n\n\nOs passos do item dois podem ser generalizados para todos os pares de espécies utilizando uma série de operações matriciais.\n\n1. **Matriz de Produtos Escalares ($\\mathbf{E}$)**:\n$$\\mathbf{E} = \\mathbf{T}^\\top \\mathbf{T}$$\n\n$$\\mathbf{T^\\top} = \n\\begin{bmatrix}\n1.67 & 0.21 & \\dots & 1.26\\\\\n1.71 & 0.26 & \\dots & 1.74\\\\\n\\vdots & \\vdots & \\ddots & \\vdots\\\\\n0.66 & 0.19 & \\dots & 3.14\n\\end{bmatrix}, \\quad\n\\mathbf{E} = \n\\begin{bmatrix}\ne_{11} & e_{12} & \\dots & e_{18}\\\\\ne_{21} & e_{22} & \\dots & e_{28}\\\\\n\\vdots & \\vdots & \\ddots & \\vdots\\\\\ne_{81} & e_{82} & \\dots & e_{88}\n\\end{bmatrix}\n$$\n\n<!-- ```{r}\n#| label: tbl-tr\n#| tbl-cap: Transposta da matriz T.\nTR |> \n   t() |> \n   as.data.frame() |> \n   rownames_to_column(\"Espécie\") |> \n   gt() |> \n  fmt_number(\n    columns = where(is.numeric),\n    decimals = 4                \n  ) |> \n  tab_options(\n    table.font.size = px(13),\n    table.font.names = \"Arial\"\n  )\n``` -->\n\n<!-- ```{r}\n#| label: tbl-E\n#| tbl-cap: Matriz $\\mathbf{E}$ de produtos escalares.\n#| eval: false\nE |> \n   as.data.frame() |> \n   rownames_to_column(\"Espécie\") |> \n   gt() |> \n  fmt_number(\n    columns = where(is.numeric),\n    decimals = 4                \n  ) |> \n  tab_options(\n    table.font.size = px(13),\n    table.font.names = \"Arial\"\n  )\n``` -->\n\n2. **Normas e Matriz $\\mathbf{D}$**:\n\nNorma dos vetores colunas da matriz $\\mathbf{E}$:\n$$\\text{norma}_i = \\sqrt{e_{ii}}$$\n\nMatriz $\\mathbf{D}$:\n$$\\mathbf{D} = \n\\begin{bmatrix}\n\\frac{1}{\\sqrt{e_{11}}} & 0 & \\dots & 0\\\\\n0 & \\frac{1}{\\sqrt{e_{22}}} & \\dots & 0\\\\\n\\vdots & \\vdots & \\ddots & \\vdots\\\\\n0 & 0 & \\dots & \\frac{1}{\\sqrt{e_{88}}}\n\\end{bmatrix}\n$$\n\n<!-- ```{r}\n#| label: tbl-D\n#| tbl-cap: Matriz diagonal $\\mathbf{D}$.\n#| eval: false\nD |> \n   as.data.frame() |> \n   setNames(colnames(tf)) |> \n   mutate(Espécie = colnames(tf), .before = 1)  |> \n   gt() |> \n  fmt_number(\n    columns = where(is.numeric),\n    decimals = 4                \n  ) |> \n  sub_values(\n    columns = where(is.numeric),\n    fn = function(x) x == 0,  # Identifica os valores 0\n    replacement = \"0\"         # Formata como inteiro (sem decimais)\n  ) |> \n  tab_options(\n    table.font.size = px(13),\n    table.font.names = \"Arial\"\n  )\n``` -->\n\n3. **Matriz Final ($\\mathbf{C}$)**:\n\n$$\\mathbf{C} = \\mathbf{D} \\mathbf{E} \\mathbf{D}\n$$ {#eq-similaridade_cossenos}\n\n<!-- ```{r}\n#| label: tbl-C\n#| tbl-cap: Matriz $\\mathbf{C}$ de Similaridade por cossenos entre os pares de espécies.\n#| eval: false\nC |> \n  as.data.frame() |> \n  setNames(colnames(tf)) |> \n  mutate(Espécie = colnames(tf), .before = 1) |> \n  gt() |> \n  fmt_number(\n    columns = where(is.numeric),\n    decimals = 4\n  ) |> \n  data_color(\n    columns = where(is.numeric),\n    fn = scales::col_bin(\n      # palette = c(\"red\", \"orange\", \"yellow\", \"lightgreen\", \"green\", \"blue\", 'black'),\n      palette = c(\"salmon3\", \"orangered3\",  \"rosybrown4\", \"orchid4\", \"skyblue2\", \"dodgerblue3\", 'royalblue4'),\n      domain = c(0.7, 1),\n      bins = c(0.7, 0.75, 0.8, 0.85, 0.9, 0.95, 0.9999, 1.0001) \n    )\n  ) |> \n  tab_options(\n    table.font.size = px(13),\n    table.font.names = \"Arial\"\n  )\n``` -->\n\n---\n\n```{=typst}\n#pagebreak()\n```\n\n## Roteiro: Matriz de Similaridade no Google Planilhas\n\n1. Acesse [sheets.google.com](https://sheets.google.com).\n2. Insira os dados da tabela $\\mathbf{T}$ (@tbl-tracos). *Se necessário modifique o decimal de ponto (`.`) para vírgula (`,`)*.\n3. Calcule $\\mathbf{T}^\\top$.\n   + Dica - utilize as fórmulas:  \n\n      ```excel\n      =TRANSPOR()\n      ```\n\n4. Calcule a matriz $\\mathbf{E}$.\n   + Dica - utilize as fórmulas: \n\n      ```excel\n      =TRANSPOR()\n      =MATRIZ.MULT()\n      ```\n\n5. Calcule as normas das colunas da matriz $\\mathbf{E}$ e monte a matriz diagonal $\\mathbf{D}$.\n   + Dica: A matriz diagonal $\\mathbf{D}$ terá as mesmas dimensões de $\\mathbf{E}$, mas será preenchida com zeros exceto na diagonal principal. Nela, os valores serão $\\frac{1}{\\sqrt{e_{ii}}}$, onde $e_{ii}$ são os elementos da diagonal principal de $\\mathbf{E}$.\n6. Calcule a matriz $\\mathbf{C}$ conforme a @eq-similaridade_cossenos.\n   + Dica - utilize a fórmula:   \n\n      ```excel\n      =MATRIZ.MULT()\n      ```\n\n7. **Verificação**: calcule o cosseno de $\\theta$ entre algumas espécies utilizando a @eq-cos-angulo e verifique se os resultados coincidem com os observados na $\\mathbf{C}$.\n\n8. **Verificação**: Observe a matriz para identificar pares de espécies mais similares entre si e avalie se o resultado faz sentido à luz das imagens da @fig-peixes.\n\n",
    "supporting": [
      "cossine-similarity_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}