{
  "hash": "084831eb0094e051d3859cf201c2244c",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Construindo um modelo bayesiano\"  \nsubtitle: \"Verossimilhança e distribuição *a priori*\"  \ndescription: \"Construção de um modelo bayesiano, enfatizando a formulação de distribuições a priori e posterior.\"\nCategories: [\n          \"Inferência bayesiana\",\n          \"Distribuição a priori\",\n          \"Distribuição posterior\",\n          \"Modelo binomial\"\n        ]\nimage: \"images/intro-bayes-modelo-bayesiano.png\"  \nexecute:\n  echo: false\n  warning: false\n  include: true\n  message: false\n---\n\n\n---\n\nConsidere um globo representando o planeta Terra, pequeno o suficiente para caber em suas mãos. Seu objetivo é estimar a fração da superfície coberta por água. Para isso, você adota a seguinte estratégia: joga o globo para cima girando e, ao pegá-lo, registra se o ponto tocado pelo seu dedo indicador direito é água (🌊) ou terra (🏜️). Você repete esse procedimento algumas vezes, obtendo uma sequência de $n$ observações.\n\nVocê faz quatro lançamentos do globo e conta quantos deles resultam em água. Um possível resultado seria $🌊🌊🏜️🌊$, totalizando 3 observações de água e 1 de terra. Outro resultado possível é $🏜️🏜️🌊🌊$, com 2 observações de água e 2 de terra. Para $n = 4$ observações, existem 16 resultados possíveis (@tbl-proporcao-globo).\n\n| Nº |       Dados       | Nº pontos na água | Proporção de pontos na água |\n|:--:|:-----------------:|:-----------------:|:----------------------------:|\n|  1 | 🏜️ 🏜️ 🏜️ 🏜️      | 0                 | 0/4 = 0.00                   |\n|  2 | 🏜️ 🏜️ 🏜️ 🌊      | 1                 | 1/4 = 0.25                   |\n|  3 | 🏜️ 🏜️ 🌊 🏜️      | 1                 | 1/4 = 0.25                   |\n|  4 | 🏜️ 🌊 🏜️ 🏜️      | 1                 | 1/4 = 0.25                   |\n|  5 | 🌊 🏜️ 🏜️ 🏜️      | 1                 | 1/4 = 0.25                   |\n|  6 | 🏜️ 🏜️ 🌊 🌊      | 2                 | 2/4 = 0.50                   |\n|  7 | 🏜️ 🌊 🏜️ 🌊      | 2                 | 2/4 = 0.50                   |\n|  8 | 🏜️ 🌊 🌊 🏜️      | 2                 | 2/4 = 0.50                   |\n|  9 | 🌊 🏜️ 🏜️ 🌊      | 2                 | 2/4 = 0.50                   |\n| 10 | 🌊 🏜️ 🌊 🏜️      | 2                 | 2/4 = 0.50                   |\n| 11 | 🌊 🌊 🏜️ 🏜️      | 2                 | 2/4 = 0.50                   |\n| 12 | 🏜️ 🌊 🌊 🌊      | 3                 | 3/4 = 0.75                   |\n| 13 | 🌊 🏜️ 🌊 🌊      | 3                 | 3/4 = 0.75                   |\n| 14 | 🌊 🌊 🏜️ 🌊      | 3                 | 3/4 = 0.75                   |\n| 15 | 🌊 🌊 🌊 🏜️      | 3                 | 3/4 = 0.75                   |\n| 16 | 🌊 🌊 🌊 🌊      | 4                 | 4/4 = 1.00                   |\n\n: **Resultados possíveis de 4 observações (terra ou água) com o respectivo número e proporção de observações em água.** {#tbl-proporcao-globo .striped .hover}\n\nObserve que apenas um dos resultados contém 4 observações de terra e somente um contém 4 observações de água. Os demais são variações entre esses extremos.\n\nPodemos reorganizar a tabela para evidenciar todas as combinações que levam ao mesmo número $y_i$ de pontos em água:\n\n| Nº pontos na água ($y_i$) | Dados | Nº de combinações |\n|:---------------------------:|:------|:-----------------|\n| 0 | 🏜️ 🏜️ 🏜️ 🏜️ | 1 |\n| 1 | 🏜️ 🏜️ 🏜️ 🌊 <br> 🏜️ 🌊 🏜️ 🏜️ <br> 🏜️ 🏜️ 🌊 🏜️ <br> 🌊 🏜️ 🏜️ 🏜️ | 4 |\n| 2 | 🏜️ 🏜️ 🌊 🌊 <br> 🏜️ 🌊 🏜️ 🌊 <br> 🏜️ 🌊 🌊 🏜️ <br> 🌊 🏜️ 🏜️ 🌊 <br> 🌊 🏜️ 🌊 🏜️ <br> 🌊 🌊 🏜️ 🏜️ | 6 |\n| 3 | 🏜️ 🌊 🌊 🌊 <br> 🌊 🏜️ 🌊 🌊 <br> 🌊 🌊 🏜️ 🌊 <br> 🌊 🌊 🌊 🏜️ | 4 |\n| 4 | 🌊 🌊 🌊 🌊 | 1 |\n\n: **Combinações que resultam em $y_i$ pontos na água.** {#tbl-combinacao-globo tbl-colwidths=\"[25,50,25]\" .striped .hover}\n\n<br>\n\nDefina $p$ como a probabilidade de observar água e $1 - p$ como a probabilidade de observar terra após cada lançamento do globo.\n\nA última linha da @tbl-combinacao-globo (🌊🌊🌊🌊) tem probabilidade:\n$$P(4) = p \\times p \\times p \\times p.$$\n\nEnquanto a primeira linha (🏜️🏜️🏜️🏜️) ocorre com probabilidade:\n$$P(0) = (1 - p) \\times (1 - p) \\times (1 - p) \\times (1 - p).$$\n\nAs linhas correspondentes a $P(1)$, $P(2)$ e $P(3)$ são combinações de $p$ e $(1 - p)$, multiplicadas pelo número de formas pelas quais 1, 2 ou 3 registros de água podem ocorrer em 4 lançamentos.\n\n<br>\n\n| Nº pontos na água ($y_i$) | Dados | Nº de combinações | $P(Y)$ |\n|:---------------------------:|:------|:-----------------:|:--------|\n| 0 | 🏜️ 🏜️ 🏜️ 🏜️ | 1 | $1 \\times (1-p) \\times (1-p) \\times (1-p) \\times (1-p)$ |\n| 1 | 🏜️ 🏜️ 🏜️ 🌊 <br> 🏜️ 🌊 🏜️ 🏜️ <br> 🏜️ 🏜️ 🌊 🏜️ <br> 🌊 🏜️ 🏜️ 🏜️ | 4 | $4 \\times p \\times (1-p) \\times (1-p) \\times (1-p)$ |\n| 2 | 🏜️ 🏜️ 🌊 🌊 <br> 🏜️ 🌊 🏜️ 🌊 <br> 🏜️ 🌊 🌊 🏜️ <br> 🌊 🏜️ 🏜️ 🌊 <br> 🌊 🏜️ 🌊 🏜️ <br> 🌊 🌊 🏜️ 🏜️ | 6 | $6 \\times p \\times p \\times (1-p) \\times (1-p)$ |\n| 3 | 🏜️ 🌊 🌊 🌊 <br> 🌊 🏜️ 🌊 🌊 <br> 🌊 🌊 🏜️ 🌊 <br> 🌊 🌊 🌊 🏜️ | 4 | $4 \\times p \\times p \\times p  \\times (1-p)$ |\n| 4 | 🌊 🌊 🌊 🌊 | 1 | $(p) \\times p \\times p \\times p$ |\n\n: **Probabilidade $P(Y)$ de observar diferentes números ($y_i$) de pontos sobre a água.** {#tbl-probabilidade-globo tbl-colwidths=\"[25,30,15,30]\" .striped .hover}\n\n<br>\n\n## O modelo Binomial\n\nA partir das expressões para $P(Y)$ apresentadas na @tbl-probabilidade-globo, obtém-se uma fórmula geral que pode ser escrita como:\n\n$$P(Y \\mid n, p) = \\binom{n}{Y} \\, p^Y (1 - p)^{n - Y}.\n$${#eq-binomial}\n\n**Onde:**\n\n- $Y \\in \\{0, 1, 2, \\dots, n\\}$ é o número de observações de 🌊;\n- $n$ é o número total de observações;\n- $p$ é a fração de 🌊 que cobre o globo;\n- $\\binom{n}{Y}$ é o coeficiente binomial, calculado por $\\frac{n!}{Y!(n - Y)!}$, indicando de quantas maneiras a combinação $p^Y (1 - p)^{n - Y}$ pode ocorrer.\n\nA @eq-binomial fornece a probabilidade de cada resultado possível (número de observações 🌊) em $n$ tentativas, permitindo calcular a probabilidade de **todos** os possíveis resultados do experimento.\n\n## Verossimilhança: a plausibilidade de uma hipótese\n\n\n\nA partir do modelo binomial, podemos definir a **função de verossimilhança** para um resultado observado. Imagine que, em $n = 4$ lançamentos, foram observados $y = 2$ pontos sobre a água. Não sabemos a verdadeira proporção $p$ de água que cobre a Terra; portanto, fazemos conjecturas e avaliamos cada uma com base nas observações.\n\nPor exemplo, se supormos que a proporção verdadeira seja 40% $(p = 0.4)$, a distribuição binomial determina que a probabilidade de observar $y = 2$ sucessos em $n = 4$ lançamentos seja:\n\n$$P(Y=2 \\mid 4, 0.4) = \\binom{4}{2} \\, 0.4^2 (1 - 0.4)^{4 - 2} = 0.35$$\n\nEssa hipótese é apenas uma das possíveis. Para ilustrar outras conjecturas, considere:\n\n- Se $p = 0.3$:\n\n  $P(Y=2 \\mid 4, 0.3) = \\binom{4}{2} \\, 0.3^2 (1 - 0.3)^{4 - 2} = 0.26$\n\n- Se $p = 0.8$:\n\n  $P(Y=2 \\mid 4, 0.8) = \\binom{4}{2} \\, 0.8^2 (1 - 0.8)^{4 - 2} = 0.15$\n\nEm cada caso, os dados observados $(Y)$ e o número total de observações $(n)$ estão fixos, enquanto o parâmetro $p$ varia conforme a hipótese considerada. Embora a forma matemática seja idêntica à da função de probabilidade binomial, seu uso é diferente. Na função de probabilidade, lemos a probabilidade de $Y$ dado $n$ e $p$, enquanto nos exemplos acima, avaliamos a plausibilidade de diferentes valores de $p$ diante dos dados fixos $Y$ e $n$. \n\nPara evitar confusões, vamos definir a função de verossimilhança como:\n\n$$\n\\mathcal{L}(p \\mid n, Y) = \\binom{n}{Y} \\, p^Y (1 - p)^{n - Y}.\n$$ {#eq-likelihood-binomial}\n\nAssim, as verossimilhanças para as três conjecturas específicas sobre a proporção de água na superfície do globo serão:\n\n- $\\mathcal{L}(p = 0.3 \\mid 4, 2) = 0.26$,\n- $\\mathcal{L}(p = 0.4 \\mid 4, 2) = 0.35$,\n- $\\mathcal{L}(p = 0.8 \\mid 4, 2) = 0.15$.\n\nDessa forma, entre as três hipóteses levantadas, aquela em que $p = 0.4$ recebe **maior suporte das evidências**, por estar associada à maior verossimilhança.\n\nPodemos quantificar esse suporte por meio da **razão de verossimilhanças**:\n\n$$RV = \\frac{\\mathcal{L}(p = 0.4 \\mid 4, 2)}{\\mathcal{L}(p = 0.3 \\mid 4, 2)} = \\frac{0.35}{0.26} = 1.35,$$\n\no que indica que a hipótese $p = 0.4$ é aproximadamente $1.35$ **vezes mais verossímil** do que a hipótese $p = 0.3$ com base nos dados observados.\n\n::: {.callout-warning title=\"Resumo: A Função de Verossimilhança Binomial\"}\n\n- A expressão é **formalmente idêntica** à da distribuição binomial, porém interpretada como uma função de $p$ quando os dados $Y$ e $n$ são fixos.\n- A verossimilhança indica a plausibilidade de diferentes valores de $p$ à luz dos dados observados.\n- Na distribuição binomial, lemos: **probabilidade de $Y$ dado $n$ e $p$**.\n- Na função de verossimilhança, interpretamos: **verossimilhança de $p$ dado $n$ e $Y$**.\n- A razão de verossimilhanças pode ser utilizada para quantificar o suporte relativo entre diferentes hipóteses.\n:::\n\n### O perfil de verossimilhança\n\nAcima, foram testadas três conjecturas específicas para a proporção de água na superfície da Terra ($p = 0.3$, $p = 0.4$, $p = 0.8$). Para uma avaliação mais completa, podemos analisar o **perfil de verossimilhança** para uma série de valores de $p$ entre 0 e 1:\n\n::: {#4bdb7fd0 .cell execution_count=2}\n\n::: {.cell-output .cell-output-display}\n![](intro-bayes-modelo-bayesiano_files/figure-html/cell-3-output-1.png){width=597 height=450}\n:::\n:::\n\n\nO perfil de verossimilhança indica que, à luz dos nossos dados $y = 2$, a conjectura mais plausível é que a proporção de água que cobre a Terra esteja próxima de 0.5 (neste caso, a verossimilhança máxima é *exatamente* para $p = 0.5$).\n\n## Inferência Bayesiana: distribuições *a priori* e *a posteriori*\n\nNo contexto bayesiano, a função de verossimilhança é combinada com uma **distribuição *a priori*** para obter a **distribuição *a posteriori*** do parâmetro $p$.  \n\nPara ilustrar esse processo, retomamos as três conjecturas específicas sobre a proporção de água na superfície do globo e consideramos um caso simples, em que $p$ pode assumir **apenas três valores**: $p = 0.3$, $p = 0.4$ e $p = 0.8$.  \n\n### Hipóteses ($H$) e distribuição *a priori* uniforme\n\nDefinimos três hipóteses sobre o parâmetro $p$, cada uma correspondendo a um desses valores:\n\n- $H_1: p = 0.3$\n- $H_2: p = 0.5$\n- $H_3: p = 0.8$\n\nPara começar, vamos assumir que nossa distribuição *a priori* é **uniforme** entre essas três hipóteses, ou seja, não temos motivos para preferir uma à outra. Neste caso:\n\n$$P(p = 0.3) = P(p = 0.4) = P(p = 0.8) = \\frac{1}{3}.$$\n\nSuponha que realizamos $n = 4$ lançamentos do globo e observamos $Y = 2$ pontos de água. As verossimilhanças para cada hipótese podem ser calculadas a partir da distribuição binomial:\n\n$$\\mathcal{L}(p \\mid n=4, Y=2)\n= \\binom{4}{2}\\, p^2 (1 - p)^{2}.$$\n\nResultando em:\n\n- $\\mathcal{L}(p = 0.3 \\mid 4, 2) = 0.26$\n- $\\mathcal{L}(p = 0.4 \\mid 4, 2) = 0.35$\n- $\\mathcal{L}(p = 0.8 \\mid 4, 2) = 0.15$\n\n### Distribuição *a posteriori*\n\n\n\nVamos utilizar uma expressão análoga ao Teorema de Bayes para obter a distribuição de densidade de probabilidade *a posteriori* para $p_i$:\n\n$$P(p_i \\mid n, Y)\n= \\frac{\\mathcal{L}(p_i \\mid n, Y) \\,\\cdot\\, P(p_i)}{P(p)},$$\n\nOnde:\n\n- $P(p_i \\mid n, Y)$ é a probabilidade *a posteriori* da hipótese $H_i$ atualizada pelas observações.\n- $\\mathcal{L}(p_i \\mid n, Y)$ é a verossimilhança da hipótese $H_i$ atualizada pelas observações.\n- $P(p_i)$ é a densidade de probabilidade *a priori* da hipótese $H_i$.\n- $P(p)$ a soma ponderada de todas as verossimilhanças pelas suas *priors* (fator de normalização), garantindo que as probabilidades *a posteriori* somem 1.\n\nEm nosso exemplo:\n\n$P(p) = \\mathcal{L}(p_1 \\mid n, Y) \\,\\cdot\\, P(p_1) + \\mathcal{L}(p_2 \\mid n, Y) \\,\\cdot\\, P(p_2) + \\mathcal{L}(p_3 \\mid n, Y) \\,\\cdot\\, P(p_3)$\n\n$P(p) = \\sum_{i=1}^{3} \\mathcal{L}(D \\mid p_i) \\,\\cdot\\, P(p_i)$\n\n\nUma vez tendo assumindo uma distribuição *a priori* **uniforme** em que $P(p_i) = \\frac{1}{3}$, podemos obter as probabilidades *a posteriori* para cada hipótese. Assim temos:\n\n$P(p) = \\mathcal{L}(p_1 \\mid n, Y) \\,\\cdot\\, P(p_1) + \\mathcal{L}(p_2 \\mid n, Y) \\,\\cdot\\, P(p_2) + \\mathcal{L}(p_3 \\mid n, Y) \\,\\cdot\\, P(p_3)$\n\n$P(p) = 0.26 \\times \\frac{1}{3} + 0.35 \\times \\frac{1}{3} + 0.15 \\times \\frac{1}{3}$\n\n$P(p) = 0.09 + 0.12 + 0.05 = 0.25$\n\nDe modo que:\n\n$P(0.3 \\mid 4, 2) = \\frac{0.26 \\times \\frac{1}{3}}{0.25} \\approx 0.34$\n\n$P(0.4 \\mid 4, 2) = \\frac{0.35 \\times \\frac{1}{3}}{0.25} \\approx 0.46$\n\n$P(0.8 \\mid 4, 2) = \\frac{0.15 \\times \\frac{1}{3}}{0.25} \\approx 0.2$\n\nObserve que o valor mais alto da probabilidade *a posteriori* está associado a $p = 0.4$. Além disso, ao calcularmos a razão entre as probabilidades *a posteriori* das hipóteses $P(H_2)$ ($p = 0.4$) e $P(H_1)$ ($p = 0.3$):\n\n$$\\frac{P(0.4 \\mid 4, 2)}{P(0.3 \\mid 4, 2)} = \\frac{0.46}{0.34} = 1.35,$$\n\nobtemos exatamente o mesmo resultado encontrado anteriormente pela razão de verossimilhanças. Isso ocorre porque ao assumimos uma distribuição *a priori* uniforme, **toda a informação que diferencia as hipóteses vem exclusivamente dos dados observados**, refletida nas verossimilhanças.\n\n### Distribuição *a priori* informativa\n\nSuponha agora que há informações prévias indicando que a proporção de água sobre o globo é frequentemente **acima de 0.5**. Especificamente, vamos supor que:\n\n- $P(H_2)$ ($p = 0.4$) seja **2 vezes maior** que $P(H_1)$ $p = 0.3$,\n- $P(H_3)$ ($p = 0.8$) seja **5 vezes maior** que $P(H_1)$ $p = 0.3$.  \n\nDessa forma, teremos uma distribuição *a priori* definida como:\n\n$$P(p = 0.3) = \\frac{1}{8}, \\quad\nP(p = 0.4) = \\frac{2}{8}, \\quad\nP(p = 0.8) = \\frac{5}{8}.$$\n\n\n\n$P(p) = \\mathcal{L}(p_1 \\mid n, Y) \\,\\cdot\\, P(p_1) + \\mathcal{L}(p_2 \\mid n, Y) \\,\\cdot\\, P(p_2) + \\mathcal{L}(p_3 \\mid n, Y) \\,\\cdot\\, P(p_3)$\n\n$P(p) = 0.26 \\times \\frac{1}{8} + 0.35 \\times \\frac{2}{8} + 0.15 \\times \\frac{5}{8}$\n\n$P(p) = 0.03 + 0.09 + 0.09 = 0.21$\n\nDe modo que:\n\n$P(0.3 \\mid 4, 2) = \\frac{0.26 \\times \\frac{1}{8}}{0.21} \\approx 0.15$\n\n$P(0.4 \\mid 4, 2) = \\frac{0.35 \\times \\frac{2}{8}}{0.21} \\approx 0.41$\n\n$P(0.8 \\mid 4, 2) = \\frac{0.15 \\times \\frac{5}{8}}{0.21} \\approx 0.44$\n\n\nComo resultado, observamos que a maior probabilidade *a posteriori* recai sobre a hipótese $p = 0.8$, ainda que exista um suporte similar para $p = 0.4$. Esse resultado se deve, sobretudo, à **influência da distribuição *a priori***, que atribuiu maior peso à hipótese $H_3$.\n\n\nPortanto, na inferência bayesiana, a distribuição *a posteriori* de uma hipótese é **proporcional ao produto entre sua verossimilhança e sua probabilidade *a priori*** (Eq. @eq-posterior_proporcional):\n\n$$P(p_1 \\mid n, Y) \\;\\propto\\; \\mathcal{L}(p_1 \\mid n, Y) \\cdot P(p_i)$${#eq-posterior_proporcional}\n\nNo caso em que a distribuição *a priori* seja uniforme em todo o espaço de hipóteses, a distribuição *a posteriori* será **proporcional apenas à verossimilhança** (Eq. @eq-posterior_proporcional_uniforme):\n\n$$P(p_1 \\mid n, Y) \\;\\propto\\; \\mathcal{L}(p_1 \\mid n, Y)$${#eq-posterior_proporcional_uniforme}\n\n::: {.callout-tip title=\"Atividades interativas: estimando a proporção da superfície oceânica!\"}\n\n1. **Amostre pontos no globo e faça sua própria inferência bayesiana**  \n   No app abaixo, gere **pontos aleatórios** na superfície da Terra e verifique quantos caem em água ou em terra.  \n   \n   👉 [**Estimando a Proporção da Superfície Oceânica**](https://fcopf-dash-ocean-surface.share.connect.posit.cloud/){target=_blank}\n   \n   - Escolha quantos pontos deseja amostrar (1 a 1000).  \n   - Clique em “Gerar Pontos Aleatórios” e observe quantos ficam sobre a água versus sobre a terra.  \n   - Registre esses valores como $k$ sucessos em $N$ pontos (N observações).\n\n2. **Utilize seus dados na inferência Bayesiana**  \n   Em seguida, abra o app abaixo para visualizar como as observações (sucessos e fracassos) combinadas a diferentes escolhas de parâmetros *a priori* (α, β) geram a distribuição *a posteriori*:  \n   \n   👉 [**Inferência Bayesiana**](https://fcopf-binomial-bayesiana.share.connect.posit.cloud/){target=_blank}\n\n   **Dicas de uso**  \n   - Insira o mesmo **número de observações (N)** e **sucessos (k)** obtidos no primeiro app.  \n   - Ajuste interativamente a distribuição *a priori* Beta, modificando os parâmetros α e β.  \n   - Observe como a curva azul (“posteriori”) se altera de acordo com a *a priori* e com os dados observados, e compare com o perfil de verossimilhança (curva verde).\n\n:::\n\n",
    "supporting": [
      "intro-bayes-modelo-bayesiano_files"
    ],
    "filters": [],
    "includes": {}
  }
}